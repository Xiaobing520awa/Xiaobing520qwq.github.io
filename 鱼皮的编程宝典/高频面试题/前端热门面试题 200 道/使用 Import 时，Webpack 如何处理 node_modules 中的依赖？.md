## 使用 Import 时，Webpack 如何处理 node_modules 中的依赖？
> 八股文一网打尽，更多面试题请看[程序员面试刷题神器 - 面试鸭](https://www.mianshiya.com/)

## 回答重点

Webpack 处理 node_modules 中的依赖主要经过以下步骤：

### 1）解析路径

通过 enhanced-resolve 包解析模块路径，从当前目录开始向上查找 node_modules。

### 2）模块读取

根据 package.json 中的配置字段（main、module、browser）确定模块的入口文件。

### 3）转换处理

使用配置的 loader 处理模块内容，将其转换为 webpack 可以理解的 JavaScript 代码。

## 扩展知识

### 1）模块路径解析

1）解析顺序：

- 优先检查当前目录的 node_modules
- 未找到则逐级向上级目录查找
- 直到系统根目录的 node_modules

2）路径别名：

``` js
// webpack.config.js
module.exports = {
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
      'utils': path.resolve(__dirname, 'src/utils')
    }
  }
}
```

3）扩展名解析：

``` js
module.exports = {
  resolve: {
    extensions: ['.js', '.jsx', '.ts', '.tsx']
  }
}
```

### 2）入口文件确定

1）package.json 字段优先级：

- module：ES Module 规范入口
- main：CommonJS 规范入口
- browser：浏览器环境入口

2）示例配置：

``` json
{
  "name": "my-library",
  "main": "dist/index.js",
  "module": "dist/index.esm.js",
  "browser": "dist/index.umd.js"
}
```

### 3）优化配置

1）缓存配置：

``` js
module.exports = {
  cache: {
    type: 'filesystem',
    buildDependencies: {
      config: [__filename]
    }
  }
}
```

2）模块查找优化：

``` js
module.exports = {
  resolve: {
    modules: [
      path.resolve(__dirname, 'node_modules'),
      'node_modules'
    ],
    mainFields: ['module', 'main'],
    symlinks: false
  }
}
```

3）排除不需要解析的模块：

``` js
module.exports = {
  module: {
    noParse: /jquery|lodash/
  }
}
```

### 4）性能优化建议

1）减少搜索范围：

- 使用 resolve.modules 指定模块搜索目录
- 配置 resolve.alias 创建路径别名
- 合理使用 resolve.extensions 配置

``` js
module.exports = {
  resolve: {
    modules: [path.resolve(__dirname, 'node_modules'), 'node_modules'],
    alias: {
      '@': path.resolve(__dirname, 'src')
    },
    extensions: ['.js', '.jsx', '.ts', '.tsx']
  }
}
```

2）构建优化：

- 使用 DllPlugin 预编译第三方库
- 配置 externals 外部化某些依赖
- 开启持久化缓存提升构建速度

``` js
const TerserPlugin = require('terser-webpack-plugin');

module.exports = {
  optimization: {
    minimize: true,
    minimizer: [new TerserPlugin()],
  },
};
```

3）依赖处理：

- 使用 Tree Shaking 移除未使用代码
- 合理配置 splitChunks 分离公共模块
- 使用 bundle 分析工具优化依赖体积


> 八股文一网打尽，更多面试题请看[程序员面试刷题神器 - 面试鸭](https://www.mianshiya.com/)