## 你会如何设计前端日志埋点 SDK？
> 八股文一网打尽，更多面试题请看[程序员面试刷题神器 - 面试鸭](https://www.mianshiya.com/)

## 回答重点
我会设计一个前端日志埋点 SDK，它能够灵活、轻量地集成到任何前端项目中，并且提供日志收集、过滤、传输和监控等功能。设计的关键点包括以下内容：
1）数据捕获：提供统一的API，通过埋点收集用户行为数据、系统错误及性能数据。
2）数据过滤：在前端对收集到的数据进行预处理，比如去重、字段校验等。
3）数据传输：通过HTTP请求或WebSocket将处理后的日志数据可靠地传输到后端服务器。
4）数据存储：在传输失败时，临时存储日志数据，后续尝试重发。
5）灵活配置：支持配置不同的日志级别、埋点规则、服务器地址等。
6）性能优化：尽量减轻日志收集对页面性能的影响，例如通过批量传输、异步请求等方式。

## 扩展知识

### 数据捕获
为了高效捕获不同类型的数据，可以设计几种主要的埋点：
1）用户行为埋点：比如按钮点击、页面跳转等。
2）错误捕获埋点：捕获前端的JavaScript错误。
3）性能监控埋点：比如页面加载时间、资源加载时间等。

### 数据过滤
数据过滤的目的是保证日志的质量和降低不必要的网络开销。可以在前端进行一定的清洗和过滤操作，包括：
1）去重：同一操作的重复日志可以去重。
2）字段校验：确保必要的字段存在，防止因数据不完整导致的错误。
3）数据脱敏：对敏感信息进行脱敏处理，保障用户隐私。

### 数据传输
为了保证日志数据的可靠传输，可以使用如下策略：
1）HTTP请求：可以使用XMLHttpRequest或Fetch API发送日志。
2）WebSocket：适用于需要实时日志传输的应用场景。
3）批量传输：可以将多个日志打包成一个请求，减少请求次数。
4）传输策略：设置失败重发逻辑，确保日志最终能够被送达。

### 数据存储
在网络不稳定或后端接口不通时，可以将日志数据临时存储在本地，待网络恢复后重发。可以考虑使用浏览器的localStorage或IndexedDB来存储日志。

### 灵活配置
通过配置文件或初始化参数，灵活支持不同场景的需求，例如：
1）设置采样率，以减少日志量。
2）配置不同的日志级别：DEBUG、INFO、WARN、ERROR。
3）指定不同的日志上报服务器地址。
4）灵活添加自定义埋点规则。

### 性能优化
收集日志时应尽量减少对用户体验的影响，比如：
1）使用批量传输减少单次请求的频率。
2）采用异步请求不阻塞主线程。
3）配合Web Workers在后台进行复杂的处理和传输。



> 八股文一网打尽，更多面试题请看[程序员面试刷题神器 - 面试鸭](https://www.mianshiya.com/)